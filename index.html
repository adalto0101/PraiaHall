<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Praia Hall | Gest√£o v1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        * { font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.2s ease; }
        
        body { 
            background: linear-gradient(-45deg, #f1f5f9, #e2e8f0, #f8fafc, #cbd5e1);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
        }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.6); }
        .tab-active { background: #0ea5e9; color: white; box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.3); }
        
        input, select, textarea { color: #000 !important; background-color: #fff !important; border: 1px solid #cbd5e1 !important; font-size: 16px !important; }
        
        .modal-overlay { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(4px); display: none; }
        .modal-active { display: flex !important; }

        #loginScreen {
            background: linear-gradient(rgba(15, 23, 42, 0.8), rgba(15, 23, 42, 0.9)), url('https://praiahall.com.br/wp-content/uploads/2025/03/camarote3.png');
            background-size: cover; background-position: center;
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <audio id="audioSuccess" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

    <div id="customAlert" class="modal-overlay fixed inset-0 z-[200] items-center justify-center p-4">
        <div class="bg-white rounded-[2.5rem] p-8 w-full max-w-[350px] text-center shadow-2xl scale-90">
            <div id="alertIcon" class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl"></div>
            <h3 id="alertTitle" class="text-xl font-extrabold text-slate-800 mb-2"></h3>
            <p id="alertMsg" class="text-slate-500 text-sm mb-6"></p>
            <button onclick="closeAlert()" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold">ENTENDIDO</button>
        </div>
    </div>

    <div id="masterPassModal" class="modal-overlay fixed inset-0 z-[150] items-center justify-center p-4">
        <div class="bg-white rounded-[2.5rem] p-8 w-full max-w-[350px] shadow-2xl">
            <h3 class="text-xl font-extrabold text-slate-800 mb-4">Autoriza√ß√£o</h3>
            <p class="text-slate-500 text-xs mb-4 uppercase font-bold">Digite a Senha Mestre:</p>
            <input type="password" id="inputMasterPass" class="w-full px-5 py-3 rounded-2xl mb-4 text-center text-2xl tracking-[10px]">
            <div class="flex gap-2">
                <button onclick="closeMasterModal()" class="flex-1 py-3 font-bold text-slate-400">CANCELAR</button>
                <button onclick="confirmMasterAction()" class="flex-1 bg-red-500 text-white py-3 rounded-xl font-bold">CONFIRMAR</button>
            </div>
        </div>
    </div>

    <div id="loginScreen" class="fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl w-full max-w-[400px]">
            <div id="loginMain">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-sky-500 rounded-2xl flex items-center justify-center mx-auto mb-4"><i class="fas fa-umbrella-beach text-white text-3xl"></i></div>
                    <h2 class="text-2xl font-extrabold text-slate-800">Praia Hall</h2>
                </div>
                <div class="space-y-4">
                    <input type="email" id="loginEmail" placeholder="E-mail" class="w-full px-5 py-3.5 rounded-2xl outline-none">
                    <div class="relative">
                        <input type="password" id="loginPass" placeholder="Senha" class="w-full px-5 py-3.5 rounded-2xl outline-none">
                        <button onclick="togglePass('loginPass', 'eyeLogin')" class="absolute right-4 top-4 text-slate-300"><i id="eyeLogin" class="fas fa-eye"></i></button>
                    </div>
                    <button onclick="handleLogin()" class="w-full bg-sky-600 text-white py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95">ENTRAR</button>
                    <div class="text-center">
                        <button onclick="toggleRecovery(true)" class="text-sky-600 text-xs font-bold">Esqueci minha senha</button>
                    </div>
                </div>
            </div>

            <div id="recoveryForm" class="hidden">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Recuperar Senha</h3>
                <p class="text-slate-400 text-sm mb-6">Enviaremos um link oficial para o seu e-mail cadastrado.</p>
                <input type="email" id="recoveryEmail" placeholder="Digite seu e-mail" class="w-full px-5 py-3.5 rounded-2xl mb-4">
                <button onclick="handleRecovery()" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold mb-4">ENVIAR LINK</button>
                <button onclick="toggleRecovery(false)" class="w-full text-slate-400 text-sm font-bold">VOLTAR AO LOGIN</button>
            </div>
        </div>
    </div>

    <div id="mainContent" class="hidden">
        <header class="glass px-6 h-16 flex items-center justify-between sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <span class="bg-sky-500 text-white p-2 rounded-lg text-xs font-black">PH</span>
                <h1 class="font-bold text-slate-800 tracking-tight">PRAIA HALL</h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <p id="userNameDisplay" class="text-xs font-bold text-slate-800 leading-none"></p>
                    <p id="userRoleDisplay" class="text-[10px] text-slate-400 uppercase font-medium"></p>
                </div>
                <button onclick="logout()" class="text-slate-400 hover:text-red-500 text-xl px-2 border-l border-slate-100 pl-4">
                    <i class="fas fa-power-off"></i>
                </button>
            </div>
        </header>

        <nav class="px-6 py-4 flex gap-2 overflow-x-auto no-scrollbar">
            <button onclick="showTab('dashboard')" id="tab-dashboard" class="tab-active px-6 py-3 rounded-xl text-sm font-bold whitespace-nowrap"><i class="fas fa-list-ul mr-2"></i>Reservas</button>
            <button onclick="showTab('consultas')" id="tab-consultas" class="bg-white/60 px-6 py-3 rounded-xl text-sm font-bold text-slate-600 whitespace-nowrap"><i class="fas fa-calendar-alt mr-2"></i>Vagas</button>
            <button onclick="showTab('operador')" id="tab-operador" class="bg-white/60 px-6 py-3 rounded-xl text-sm font-bold text-slate-600 whitespace-nowrap"><i class="fas fa-plus mr-2"></i>Nova Reserva</button>
            <button onclick="showTab('stats')" id="tab-stats" class="hidden bg-white/60 px-6 py-3 rounded-xl text-sm font-bold text-slate-600 whitespace-nowrap"><i class="fas fa-chart-bar mr-2"></i>Desempenho</button>
            <button onclick="showTab('config')" id="tab-config" class="hidden bg-amber-50 px-6 py-3 rounded-xl text-sm font-bold text-amber-600 border border-amber-100 whitespace-nowrap"><i class="fas fa-users-cog mr-2"></i>Equipe</button>
        </nav>

        <main class="p-4 md:p-6 max-w-7xl mx-auto">
            
            <div id="content-dashboard" class="tab-content">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-2xl font-extrabold text-slate-800">Agenda de Reservas</h2>
                        <p class="text-slate-400 text-sm">Lista detalhada de clientes confirmados.</p>
                    </div>
                    <div class="relative w-full md:w-80">
                        <i class="fas fa-search absolute left-4 top-4 text-slate-300"></i>
                        <input type="text" id="searchInput" onkeyup="filtrarReservas()" placeholder="Buscar nome..." class="w-full pl-11 pr-4 py-3 border border-slate-200 rounded-xl outline-none shadow-sm">
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b border-slate-200">
                                <tr class="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
                                    <th class="px-6 py-4">Cliente</th>
                                    <th class="px-6 py-4 text-center">Data / Hora</th>
                                    <th class="px-6 py-4">Setor / Pessoas</th>
                                    <th class="px-6 py-4">Observa√ß√µes</th>
                                    <th class="px-6 py-4 text-right">A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody id="reservasTable" class="divide-y divide-slate-100">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="content-consultas" class="tab-content hidden">
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <h3 class="font-bold text-lg">Mapa de Disponibilidade</h3>
                    <input type="date" id="consultaDataInput" onchange="atualizarConsultaVagas()" class="px-5 py-3 border rounded-2xl font-bold text-sky-600">
                </div>
                <div id="cardsConsulta" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
            </div>

            <div id="content-operador" class="tab-content hidden">
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-[2.5rem] shadow-2xl border">
                    <h3 class="text-2xl font-bold mb-6 text-slate-800">Nova Reserva</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2"><label class="text-xs font-bold text-slate-400 ml-2">NOME</label><input type="text" id="formNome" class="w-full px-5 py-3 rounded-xl"></div>
                        <div><label class="text-xs font-bold text-slate-400 ml-2">WHATSAPP</label><input type="tel" id="formTel" class="w-full px-5 py-3 rounded-xl"></div>
                        <div><label class="text-xs font-bold text-slate-400 ml-2">DATA</label><input type="date" id="formData" class="w-full px-5 py-3 rounded-xl"></div>
                        <div><label class="text-xs font-bold text-slate-400 ml-2">HORA</label><select id="formHora" class="w-full px-5 py-3 rounded-xl"><option>12:00</option><option>13:00</option><option>19:00</option><option>20:00</option></select></div>
                        <div><label class="text-xs font-bold text-slate-400 ml-2">PESSOAS</label><input type="number" id="formQtd" value="2" class="w-full px-5 py-3 rounded-xl"></div>
                        <div class="md:col-span-2"><label class="text-xs font-bold text-slate-400 ml-2">AMBIENTE</label><select id="formTipo" class="w-full px-5 py-3 rounded-xl"><option>Rod√≠zio</option><option>√Ä la Carte</option><option>Deck</option><option>Camarote</option></select></div>
                        <div class="md:col-span-2"><label class="text-xs font-bold text-slate-400 ml-2">NOTAS ESPECIAIS</label><textarea id="formObs" class="w-full px-5 py-3 rounded-xl" rows="2"></textarea></div>
                        <div class="md:col-span-2 flex items-center gap-3 p-4 bg-amber-50 rounded-2xl border border-amber-100">
                            <input type="checkbox" id="formAniversariante" class="w-6 h-6">
                            <label class="text-sm font-bold text-amber-700 uppercase">Aniversariante üéÇ</label>
                        </div>
                    </div>
                    <button onclick="submitReserva()" class="w-full bg-sky-600 text-white font-bold py-5 rounded-3xl mt-6 text-lg shadow-lg">CONFIRMAR RESERVA</button>
                </div>
            </div>

            <div id="content-stats" class="tab-content hidden">
                <div class="bg-white p-8 rounded-[2.5rem] border shadow-sm">
                    <h3 class="font-extrabold text-xl mb-6">Desempenho da Equipe</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-slate-50">
                                <tr class="text-left border-b">
                                    <th class="p-4">Operador</th>
                                    <th class="p-4 text-center">Total de Reservas</th>
                                </tr>
                            </thead>
                            <tbody id="listaStats" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="content-config" class="tab-content hidden">
                <div class="bg-white p-8 rounded-[2.5rem] border shadow-sm">
                    <h3 class="font-extrabold text-xl mb-6">Equipe de Gest√£o</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3 bg-slate-50 p-6 rounded-[2rem] mb-8">
                        <input type="text" id="newOpNome" placeholder="Nome" class="px-4 py-3 border rounded-xl">
                        <input type="email" id="newOpEmail" placeholder="E-mail" class="px-4 py-3 border rounded-xl">
                        <div class="relative">
                            <input type="password" id="newOpPass" placeholder="Senha" class="w-full px-4 py-3 border rounded-xl">
                            <button onclick="togglePass('newOpPass', 'eyeOp')" class="absolute right-3 top-3 text-slate-400"><i id="eyeOp" class="fas fa-eye"></i></button>
                        </div>
                        <select id="newOpPerfil" class="px-4 py-3 border rounded-xl">
                            <option value="Operador">Operador</option>
                            <option value="Consultor">Consultor</option>
                            <option value="Supervisor">Supervisor</option>
                        </select>
                        <button onclick="adicionarOperador()" class="bg-sky-600 text-white font-bold rounded-xl py-3">CADASTRAR</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead><tr class="text-left border-b"><th>Nome</th><th>E-mail</th><th>Perfil</th><th class="text-right">A√ß√£o</th></tr></thead>
                            <tbody id="listaOperadores" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp, deleteApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged, signOut, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, push, onValue, remove, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB2JKxC0RLzNhiORvIDqdirNI6BTmu4hP0",
            authDomain: "praia-hall-d75e4.firebaseapp.com",
            databaseURL: "https://praia-hall-d75e4-default-rtdb.firebaseio.com",
            projectId: "praia-hall-d75e4",
            storageBucket: "praia-hall-d75e4.firebasestorage.app",
            messagingSenderId: "200731512510",
            appId: "1:200731512510:web:0328f6048fdd6e0c9c18ef"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const SENHA_MASTER = "PH2026";
        let USER_DATA = null;
        let TODAS_RESERVAS = [];
        let DELETE_ID = null;
        let CAPACIDADES = { rodizio: 80, alacarte: 40, deck: 30, camarote: 20 };

        window.showAlert = (title, msg, type = 'success') => {
            if(type === 'success') document.getElementById('audioSuccess').play();
            const icon = document.getElementById('alertIcon');
            icon.className = `w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl ${type === 'success' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`;
            icon.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check' : 'fa-exclamation-triangle'}"></i>`;
            document.getElementById('alertTitle').innerText = title;
            document.getElementById('alertMsg').innerText = msg;
            document.getElementById('customAlert').classList.add('modal-active');
        };
        window.closeAlert = () => document.getElementById('customAlert').classList.remove('modal-active');

        window.togglePass = (id, iconId) => {
            const el = document.getElementById(id);
            const icon = document.getElementById(iconId);
            el.type = el.type === 'password' ? 'text' : 'password';
            icon.classList.toggle('fa-eye'); icon.classList.toggle('fa-eye-slash');
        };

        window.toggleRecovery = (show) => {
            document.getElementById('loginMain').classList.toggle('hidden', show);
            document.getElementById('recoveryForm').classList.toggle('hidden', !show);
        };

        window.handleLogin = async () => {
            const e = document.getElementById('loginEmail').value;
            const p = document.getElementById('loginPass').value;
            try { await signInWithEmailAndPassword(auth, e, p); } 
            catch { showAlert("Erro", "Login ou senha incorretos.", "error"); }
        };

        window.handleRecovery = async () => {
            const email = document.getElementById('recoveryEmail').value;
            if(!email) return showAlert("Aten√ß√£o", "Digite o e-mail.", "error");
            try {
                await sendPasswordResetEmail(auth, email);
                showAlert("Sucesso", "Link enviado para sua caixa de entrada.");
                toggleRecovery(false);
            } catch (err) { showAlert("Erro", "E-mail n√£o encontrado.", "error"); }
        };

        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const snap = await get(ref(db, 'operadores'));
                const ops = snap.val() || {};
                USER_DATA = Object.values(ops).find(o => o.email.toLowerCase() === user.email.toLowerCase());
                if (USER_DATA) {
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    
                    // Exibe nome no Header
                    document.getElementById('userNameDisplay').innerText = USER_DATA.nome;
                    document.getElementById('userRoleDisplay').innerText = USER_DATA.perfil;

                    if(USER_DATA.perfil === 'Supervisor') {
                        document.getElementById('tab-config').classList.remove('hidden');
                        document.getElementById('tab-stats').classList.remove('hidden');
                        carregarEquipe();
                    }
                    if(USER_DATA.perfil === 'Consultor') document.getElementById('tab-operador').classList.add('hidden');
                    document.getElementById('consultaDataInput').value = new Date().toISOString().split('T')[0];
                    escutarDados();
                } else { signOut(auth); }
            } else {
                document.getElementById('mainContent').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
            }
        });

        window.adicionarOperador = async () => {
            const n = document.getElementById('newOpNome').value;
            const e = document.getElementById('newOpEmail').value;
            const p = document.getElementById('newOpPass').value;
            const role = document.getElementById('newOpPerfil').value;
            if(!n || !e || !p) return showAlert("Aten√ß√£o", "Preencha todos os campos.", "error");

            const secondaryApp = initializeApp(firebaseConfig, "Secondary");
            const secondaryAuth = getAuth(secondaryApp);

            try {
                const userCredential = await createUserWithEmailAndPassword(secondaryAuth, e, p);
                await set(ref(db, 'operadores/' + userCredential.user.uid), { nome: n, email: e.toLowerCase(), perfil: role });
                await signOut(secondaryAuth);
                await deleteApp(secondaryApp);
                showAlert("Sucesso", "Membro da equipe cadastrado!");
                document.getElementById('newOpNome').value = ""; document.getElementById('newOpEmail').value = ""; document.getElementById('newOpPass').value = "";
            } catch (err) { showAlert("Erro", "E-mail j√° existe ou senha fraca.", "error"); }
        };

        function escutarDados() {
            onValue(ref(db, 'reservas'), (snap) => {
                TODAS_RESERVAS = Object.keys(snap.val() || {}).map(k => ({uid: k, ...snap.val()[k]})).reverse();
                renderTabela(TODAS_RESERVAS);
                atualizarConsultaVagas();
                if(USER_DATA && USER_DATA.perfil === 'Supervisor') atualizarStats();
            });
        }

        function renderTabela(lista) {
            const tbody = document.getElementById('reservasTable');
            tbody.innerHTML = lista.map(r => {
                const badges = {
                    "Rod√≠zio": "bg-red-100 text-red-700",
                    "√Ä la Carte": "bg-green-100 text-green-700",
                    "Deck": "bg-yellow-100 text-yellow-700",
                    "Camarote": "bg-blue-100 text-blue-700"
                };
                const badgeClass = badges[r.tipo] || "bg-slate-100 text-slate-700";
                const dataFormatada = r.data ? r.data.split('-').reverse().join('/') : '---';

                return `
                <tr class="even:bg-slate-50/50 hover:bg-sky-50 transition-colors">
                    <td class="px-6 py-5">
                        <div class="flex items-center gap-3">
                            <div class="w-9 h-9 bg-slate-100 rounded-lg flex items-center justify-center text-slate-400 font-bold text-xs uppercase">
                                ${r.cliente ? r.cliente.substring(0,2) : '??'}
                            </div>
                            <div>
                                <p class="font-bold text-slate-800 text-sm leading-none mb-1">
                                    ${r.cliente} ${r.aniversariante === 'Sim' ? 'üéÇ' : ''}
                                </p>
                                <p class="text-xs text-sky-600 font-medium">
                                    <i class="fab fa-whatsapp mr-1"></i>${r.tel}
                                </p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-5 text-center">
                        <p class="text-sm font-bold text-slate-700">${dataFormatada}</p>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-tight">${r.hora}</p>
                    </td>
                    <td class="px-6 py-5">
                        <span class="${badgeClass} px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wide border border-black/5">
                            ${r.tipo}
                        </span>
                        <p class="text-[11px] text-slate-500 mt-2 font-medium">
                            <i class="fas fa-users mr-1"></i>${r.qtd} Pessoas
                        </p>
                    </td>
                    <td class="px-6 py-5">
                        <p class="text-xs text-slate-500 italic line-clamp-2 max-w-[200px]">
                            ${r.obs || '<span class="text-slate-200 italic">Sem observa√ß√µes</span>'}
                        </p>
                    </td>
                    <td class="px-6 py-5 text-right">
                        ${USER_DATA && USER_DATA.perfil !== 'Consultor' ? `
                            <button onclick="openMasterModal('${r.uid}')" class="w-8 h-8 rounded-lg bg-red-50 text-red-400 hover:bg-red-500 hover:text-white transition-all">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>` : ''}
                    </td>
                </tr>`;
            }).join('');
        }

        window.submitReserva = async () => {
            try {
                const d = {
                    cliente: document.getElementById('formNome').value,
                    tel: document.getElementById('formTel').value,
                    data: document.getElementById('formData').value,
                    hora: document.getElementById('formHora').value,
                    qtd: document.getElementById('formQtd').value,
                    tipo: document.getElementById('formTipo').value,
                    obs: document.getElementById('formObs').value,
                    aniversariante: document.getElementById('formAniversariante').checked ? 'Sim' : 'N√£o',
                    operadorNome: USER_DATA.nome // Atrela ao operador atual
                };
                if(!d.cliente || !d.data) return showAlert("Aten√ß√£o", "Preencha Nome e Data.", "error");
                await push(ref(db, 'reservas'), d);
                showAlert("Sucesso", "Reserva confirmada!");
                showTab('dashboard');
                document.getElementById('formNome').value = ""; document.getElementById('formTel').value = ""; document.getElementById('formObs').value = "";
            } catch (err) { showAlert("Erro", "Falha ao salvar reserva.", "error"); }
        };

        window.atualizarStats = () => {
            const contagem = {};
            TODAS_RESERVAS.forEach(r => {
                const op = r.operadorNome || "Antigo/Manual";
                contagem[op] = (contagem[op] || 0) + 1;
            });
            document.getElementById('listaStats').innerHTML = Object.entries(contagem).map(([nome, total]) => `
                <tr>
                    <td class="p-4 font-bold text-slate-700">${nome}</td>
                    <td class="p-4 text-center">
                        <span class="bg-sky-100 text-sky-700 px-3 py-1 rounded-full font-black">${total}</span>
                    </td>
                </tr>
            `).join('');
        };

        window.atualizarConsultaVagas = () => {
            const dataS = document.getElementById('consultaDataInput').value;
            const ocup = { "Rod√≠zio": 0, "√Ä la Carte": 0, "Deck": 0, "Camarote": 0 };
            TODAS_RESERVAS.forEach(r => { if(r.data === dataS) ocup[r.tipo] += Number(r.qtd); });
            const map = { rodizio: 'Rod√≠zio', alacarte: '√Ä la Carte', deck: 'Deck', camarote: 'Camarote' };
            document.getElementById('cardsConsulta').innerHTML = Object.keys(CAPACIDADES).map(k => {
                const livre = CAPACIDADES[k] - (ocup[map[k]] || 0);
                return `<div class="bg-white p-6 rounded-[2rem] border shadow-sm text-center">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2">${map[k]}</p>
                    <p class="text-4xl font-black ${livre <= 5 ? 'text-red-500' : 'text-slate-800'}">${livre}</p>
                    <p class="text-[10px] font-bold text-slate-300 uppercase mt-2">Dispon√≠veis</p>
                </div>`;
            }).join('');
        };

        window.openMasterModal = (id) => {
            DELETE_ID = id;
            document.getElementById('masterPassModal').classList.add('modal-active');
            document.getElementById('inputMasterPass').focus();
        };
        window.closeMasterModal = () => {
            document.getElementById('masterPassModal').classList.remove('modal-active');
            document.getElementById('inputMasterPass').value = "";
        };
        window.confirmMasterAction = async () => {
            if(document.getElementById('inputMasterPass').value === SENHA_MASTER) {
                await remove(ref(db, `reservas/${DELETE_ID}`));
                closeMasterModal();
                showAlert("Sucesso", "Reserva removida.");
            } else { showAlert("Erro", "Senha Mestre Inv√°lida.", "error"); }
        };

        function carregarEquipe() {
            onValue(ref(db, 'operadores'), (snap) => {
                const list = snap.val() || {};
                document.getElementById('listaOperadores').innerHTML = Object.keys(list).map(k => `
                    <tr><td class="font-bold py-4">${list[k].nome}</td><td>${list[k].email}</td><td>${list[k].perfil}</td><td class="text-right"><button onclick="removerOp('${k}')" class="text-red-300 hover:text-red-600"><i class="fas fa-user-minus"></i></button></td></tr>
                `).join('');
            });
        }
        window.removerOp = async (id) => { if(confirm("Remover este acesso?")) await remove(ref(db, `operadores/${id}`)); };

        window.showTab = (name) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`content-${name}`).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('tab-active'));
            document.getElementById(`tab-${name}`).classList.add('tab-active');
        };

        window.filtrarReservas = () => {
            const termo = document.getElementById('searchInput').value.toLowerCase();
            const res = TODAS_RESERVAS.filter(r => r.cliente.toLowerCase().includes(termo));
            renderTabela(res);
        };
    </script>
</body>

</html>
